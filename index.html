<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>WaterHero v3.5 â€” æ¯æ—¥å–æ°´ç´€éŒ„ï¼ˆæ‰‹æ©Ÿå–®é ç‰ˆï¼‰</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/lottie-web@5.10.1/build/player/lottie.min.js"></script>

<style>
/* å…¨å±€é‡ç½® */
* { box-sizing: border-box; }
body { margin:0; padding:0; overflow-x:hidden; font-family: sans-serif; background: linear-gradient(to bottom, #e0f7ff, #ffffff); min-height:100vh; }
.glass { backdrop-filter: blur(6px); background: rgba(255,255,255,0.65); border-radius: 16px; }
.dark .glass { background: rgba(17,24,39,0.55); }
input, select { width: 100%; box-sizing: border-box; }
button { cursor:pointer; transition: transform 0.1s; }
button:active { transform: scale(0.95); }

/* æ°´æ¡¶ & èŠ±åœ’ */
.water-bucket-wrapper { position: relative; width: 80px; height: 150px; border-radius: 5px 5px 20px 20px; overflow: hidden; margin:0 auto; }
.bucket-outline { position:absolute; top:0; left:0; width:100%; height:100%; border:5px solid #a0a0a0; border-top:10px solid #888; border-radius: 5px 5px 20px 20px; pointer-events:none; }
.water-level { position:absolute; bottom:0; left:0; width:100%; height:0%; background: linear-gradient(to top, #007bff, #4dc3ff); border-radius: 0 0 15px 15px; transition: height 0.8s ease-out; }
.flower-garden { display:flex; flex-wrap:wrap; justify-content:center; align-content:flex-start; width:100%; height:150px; overflow-y:auto; padding:5px; border-radius:10px; margin-bottom:10px; border:1px dashed #c4d7e9; background:#f7fff7; position:relative; }
.dark .flower-garden { background:#1a202c; border-color:#4a5568; }
.flower-unit { font-size:2em; margin:3px; line-height:1; transform-origin: bottom center; transition: transform 0.3s; }

/* æŒ‰éˆ•æ’ç‰ˆ */
.btn-row { display:flex; gap:0.5rem; flex-wrap:wrap; margin-top:0.5rem; }
.btn-row button { flex:1 1 0; padding:0.75rem; }

/* Toast */
#toast { position: fixed; right:20px; bottom:24px; z-index:9999; display:flex; flex-direction:column; gap:8px; max-width:90%; }
.toast-item { background: rgba(0,0,0,0.8); color:#fff; padding:10px 14px; border-radius:8px; font-size:14px; }
</style>
</head>
<body class="text-slate-800 dark:text-slate-100">

<div id="toast"></div>

<div class="max-w-md mx-auto p-4">
<header class="flex items-center justify-between mb-6">
  <h1 class="text-2xl font-semibold">WaterHero v3.5 ğŸ’§</h1>
  <button id="notifyBtn" class="px-3 py-2 rounded-lg glass">æé†’</button>
</header>

<main class="grid gap-4">

<!-- ä»Šæ—¥å–æ°´ç´€éŒ„ -->
<section class="p-4 glass shadow">
  <div class="flex justify-between mb-3">
    <div>
      <div class="text-sm text-slate-500 dark:text-slate-300">ä»Šæ—¥ç›®æ¨™</div>
      <div class="text-xl font-bold"><span id="goalDisplay">2000</span> ml</div>
    </div>
    <div class="text-right">
      <div class="text-sm text-slate-500 dark:text-slate-300">å·²å–</div>
      <div class="text-xl font-bold"><span id="todayTotal">0</span> ml</div>
    </div>
  </div>

  <div class="w-full text-center text-sm mb-3">
      <p class="font-medium text-slate-600 dark:text-slate-300">ä¸‹æ¬¡æé†’å€’æ•¸:</p>
      <div id="timerDisplay" class="text-lg font-bold text-sky-500">--:--:--</div>
  </div>
  
  <div class="w-full h-4 rounded-full bg-slate-200 dark:bg-slate-700 overflow-hidden mb-3">
      <div id="progressBar" class="h-full bg-sky-400 dark:bg-sky-500" style="width:0%"></div>
  </div>

  <div class="flex flex-col gap-3">
    <input id="addInput" type="number" placeholder="è¼¸å…¥å–æ°´é‡ (ä¾‹å¦‚ 250)" class="p-3 rounded-lg border border-slate-200 dark:border-slate-700">
    <select id="unitSelect" class="p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800">
      <option value="ml">ml</option>
      <option value="cup">æ¯ (250ml)</option>
    </select>
    <div class="btn-row">
      <button id="addBtn" class="bg-sky-600 text-white rounded-lg">åŠ å…¥</button>
      <button id="undoBtn" class="bg-red-500 text-white rounded-lg">æ’¤éŠ· â†¶</button>
      <button id="resetTodayBtn" class="bg-yellow-400 text-white rounded-lg">é‡è¨­ä»Šå¤©</button>
      <button id="resetAllBtn" class="bg-gray-600 text-white rounded-lg">é‡è¨­å…¨éƒ¨</button>
    </div>
  </div>
</section>

<!-- æ¾†èŠ±å€ -->
<section class="p-4 glass shadow">
  <h3 class="text-lg font-semibold text-center mb-3">ğŸ’§ æ¾†èŠ±æŒ‘æˆ°ï¼šç´¯ç©èˆ‡æˆé•·</h3>
  <div class="flex justify-around items-end h-48">
    <div class="water-bucket-wrapper">
      <div id="waterLevel" class="water-level"></div>
      <div class="bucket-outline"></div>
    </div>

    <div class="w-2/3 flex flex-col items-center justify-end h-full">
      <div id="flowerGarden" class="flower-garden"></div>
      <button id="waterFlowerBtn" disabled class="w-full py-2 rounded-lg bg-green-600 text-white mt-2">ğŸ’§ æ¾†èŠ± (1000ml)</button>
    </div>
  </div>
</section>

<!-- æ°´ç“¶ & å¾½ç«  -->
<section class="p-4 glass shadow">
  <h3 class="text-lg font-semibold text-center mb-3">ğŸ† æ°´ç“¶èˆ‡å¾½ç« </h3>
  <div class="flex justify-between mb-2">
    <input id="bottleName" class="flex-1 p-2 rounded-lg border border-slate-200" placeholder="ç‚ºä½ çš„æ°´ç“¶å‘½å">
    <button id="bottleNameConfirm" class="ml-2 px-3 py-2 bg-blue-500 text-white rounded-lg">ç¢ºå®š</button>
  </div>
  <div class="flex justify-between mb-2">
    <div>ç­‰ç´š: <span id="bottleLevel">Lv.1</span></div>
    <div>é€£çºŒé”æ¨™: <span id="streakCount">0</span></div>
  </div>
  <div id="badgeContainer" class="flex flex-wrap gap-2"></div>
</section>

<!-- ä»Šæ—¥å–æ°´åˆ†å¸ƒåœ– -->
<section class="p-4 glass shadow">
  <h3 class="text-lg font-semibold text-center mb-3">ğŸ“Š ä»Šæ—¥å–æ°´åˆ†å¸ƒ</h3>
  <canvas id="todayChart" height="200"></canvas>
</section>

</main>
</div>

<script>
// ================== è³‡æ–™èˆ‡ç‹€æ…‹ ==================
let todayTotal = 0;
let goal = 2000;
let drinkHistory = [];
let streak = 0;
let level = 1;
let bottleName = "";
let reminderInterval = 60; // åˆ†é˜
let timer = null;

// ================== Chart.js ==================
const ctx = document.getElementById('todayChart').getContext('2d');
const chart = new Chart(ctx, {
    type:'bar',
    data: { labels:[], datasets:[{label:'æ°´é‡(ml)', data:[], backgroundColor:'#38bdf8'}]},
    options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
});

// ================== åŠŸèƒ½å‡½å¼ ==================
function updateProgress() {
    const percent = Math.min(100, (todayTotal/goal)*100);
    document.getElementById('progressBar').style.width = percent+'%';
    document.getElementById('waterFlowerBtn').disabled = todayTotal<1000;
}

function addDrink(amount) {
    todayTotal += amount;
    drinkHistory.push({time:new Date(), amount});
    chart.data.labels.push(new Date().toLocaleTimeString().slice(0,5));
    chart.data.datasets[0].data.push(amount);
    chart.update();
    document.getElementById('todayTotal').textContent = todayTotal;
    updateProgress();
}

function undoDrink() {
    if(drinkHistory.length==0) return;
    const last = drinkHistory.pop();
    todayTotal -= last.amount;
    chart.data.labels.pop();
    chart.data.datasets[0].data.pop();
    chart.update();
    document.getElementById('todayTotal').textContent = todayTotal;
    updateProgress();
}

function resetToday() {
    todayTotal = 0;
    drinkHistory = [];
    chart.data.labels = [];
    chart.data.datasets[0].data = [];
    chart.update();
    document.getElementById('todayTotal').textContent = todayTotal;
    updateProgress();
    showToast("å·²é‡è¨­ä»Šå¤©è³‡æ–™");
}

function resetAll() {
    const confirmReset = prompt("ç¢ºèªè¦é‡è¨­æ‰€æœ‰è³‡æ–™å—ï¼Ÿè¼¸å…¥ yes æ‰é‡è¨­");
    if(confirmReset==='yes'){
        todayTotal = 0;
        drinkHistory = [];
        streak = 0;
        level = 1;
        bottleName = "";
        chart.data.labels = [];
        chart.data.datasets[0].data = [];
        chart.update();
        document.getElementById('todayTotal').textContent = todayTotal;
        document.getElementById('streakCount').textContent = streak;
        document.getElementById('bottleLevel').textContent = 'Lv.'+level;
        document.getElementById('bottleName').value = '';
        document.getElementById('badgeContainer').innerHTML = '';
        updateProgress();
        showToast("å·²é‡è¨­æ‰€æœ‰è³‡æ–™");
    }
}

function waterFlower() {
    if(todayTotal<1000) return;
    todayTotal -= 1000;
    document.getElementById('todayTotal').textContent = todayTotal;
    updateProgress();
    // æ–°å¢èŠ±æœµ
    const flower = document.createElement('div');
    flower.className = 'flower-unit';
    flower.textContent = 'ğŸŒ¸';
    document.getElementById('flowerGarden').appendChild(flower);
    // èŠ±æœµå‹•ç•«
    flower.style.transform='scale(0)';
    setTimeout(()=>flower.style.transform='scale(1)',10);
    showToast("æ¾†èŠ±æˆåŠŸï¼");
}

function setBottleName() {
    bottleName = document.getElementById('bottleName').value.trim();
    if(bottleName) showToast(`æ°´ç“¶å·²å‘½åç‚º "${bottleName}"`);
}

// ================== æé†’å€’æ•¸ ==================
function startReminder(minutes){
    if(timer) clearInterval(timer);
    let remaining = minutes*60;
    document.getElementById('timerDisplay').textContent = formatTime(remaining);
    timer = setInterval(()=>{
        remaining--;
        document.getElementById('timerDisplay').textContent = formatTime(remaining);
        if(remaining<=0){ 
            clearInterval(timer);
            showToast("å–æ°´æé†’ï¼");
        }
    },1000);
}

function formatTime(sec){
    const h = Math.floor(sec/3600).toString().padStart(2,'0');
    const m = Math.floor((sec%3600)/60).toString().padStart(2,'0');
    const s = (sec%60).toString().padStart(2,'0');
    return `${h}:${m}:${s}`;
}

// ================== Toast ==================
function showToast(msg){
    const toast = document.createElement('div');
    toast.className='toast-item';
    toast.textContent = msg;
    document.getElementById('toast').appendChild(toast);
    setTimeout(()=>toast.remove(),2000);
}

// ================== äº‹ä»¶ç¶å®š ==================
document.getElementById('addBtn').addEventListener('click', ()=>{
    let val = parseInt(document.getElementById('addInput').value);
    if(isNaN(val) || val<=0) return;
    if(document.getElementById('unitSelect').value==='cup') val*=250;
    addDrink(val);
    document.getElementById('addInput').value='';
});

document.getElementById('undoBtn').addEventListener('click', undoDrink);
document.getElementById('resetTodayBtn').addEventListener('click', resetToday);
document.getElementById('resetAllBtn').addEventListener('click', resetAll);
document.getElementById('waterFlowerBtn').addEventListener('click', waterFlower);
document.getElementById('bottleNameConfirm').addEventListener('click', setBottleName);
document.getElementById('notifyBtn').addEventListener('click', ()=>startReminder(60));

</script>
</body>
</html>
